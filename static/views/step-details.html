<!--

    Copyright (c) 2013-2015 by The SeedStack authors. All rights reserved.

    This file is part of SeedStack, An enterprise-oriented full development stack.

    This Source Code Form is subject to the terms of the Mozilla Public
    License, v. 2.0. If a copy of the MPL was not distributed with this
    file, You can obtain one at http://mozilla.org/MPL/2.0/.

-->
<div class="seed-batch container-fluid" data-on-resize data-do="resizeGrids()">
    <!-- HEADER -->
    <div class="row">
        <div class="col-md-12">
            <h1 class="seed-batch-header">
                <i class="fa fa-dashboard"></i> {{ "application.view.batch.maintitle" | localize }}
            </h1>

            <div data-breadcrumb data-base-path="batch/jobs-list"></div>
        </div>
    </div>

    <div class="row">
        <!-- MAPS OF JOBS -->
        <div class="col-md-6" id="batch-map" data-ng-if="showMap">
            <h4>{{ "application.view.batch.batchmap" | localize }} {{ selectedJob }}</h4>
            <div id="batch-map-panel">
                <div data-batch-map data-job="{{ selectedJob }}" class="batch-map-diagram"></div>
            </div>
        </div>

        <!-- ACTION BUTTONS -->
        <div data-ng-class="{'col-md-12': showMap, 'col-md-12': !showMap}">
            <button class="btn btn-default" data-ng-click="showFullDetails()">
                {{ "application.view.batch.fulldetails" | localize }}
            </button>
            <button class="btn btn-default" data-ng-click="showHistory()">
                {{ "application.view.batch.history" | localize }}
            </button>
            <div data-show-status-modal></div>
            <div data-show-history-modal></div>
        </div>

        <!-- STEP EXECUTION PROGRESS CHART -->
        <div class="col-md-6">
            <h4>{{ "application.view.batch.stepsduration" | localize }} {{selectedJobExecutionId}}</h4>
            <div id="discretebar" data-w20-discrete-bar-chart="discreteBarConfig"></div>
        </div>

        <!-- STEP NAMES  -->
        <div class="col-md-6">
            <h4>{{ "application.view.batch.steps" | localize }}</h4>
            <div data-ui-grid="stepsOptions" data-ui-grid-selection data-ui-grid-auto-resize></div>
        </div>

        <!-- FULL DETAILS / HISTORY  -->
        <div class="col-md-12">
            <div class="col-md-6">
                <h4>{{ selectedStep[0].name }}</h4>
                <span> {{ "application.view.batch.stepprogress" | localize }} </span>

                <!-- STEP PROGRESS BAR -->
                <p>{{stepExecutionProgress.estimatedPercentCompleteMessage.defaultMessage}}</p>
                <div class="alert alert-danger"
                     data-ng-show="selectedStep[0].status === 'FAILED'">
                    <b> {{ "application.view.batch.failedstep" | localize }} </b>
                    <button class="btn btn-danger btn-sm pull-right"
                            data-ng-click="showFullDetails()">
                        {{ 'application.view.batch.statussteperror' | localize }}
                    </button>
                </div>
                <div data-ng-hide="selectedStep[0].status === 'FAILED'"
                     class="progress active">
                    <div class="progress-bar progress-bar-success"
                         data-role="progressbar"
                         data-aria-valuenow="0"
                         data-aria-valuemin="0"
                         data-aria-valuemax="100"
                         data-ng-style="{width : ( (stepExecutionProgress.percentageComplete * 100) + '%' ) }">
                        <span class="sr-only">{{ stepExecutionProgress.percentageComplete * 100 }}%</span>
                    </div>
                </div>

                <!-- INFO -->
                <div class="col-xs-3">
                    <small class="stats-label"><i class="fa fa-calendar"></i> Start date</small>
                    <h4>{{ selectedStep[0].startDate }}</h4>
                </div>
                <div class="col-xs-3">
                    <small class="stats-label"><i class="fa fa-play"></i> Start time</small>
                    <h4>{{ selectedStep[0].startTime }}</h4>
                </div>
                <div class="col-xs-3">
                    <small class="stats-label"><i class="fa fa-stop"></i> End time</small>
                    <h4>{{ selectedStep[0].endTime }}</h4>
                </div>
                <div class="col-xs-3">
                    <small class="stats-label"><i class="fa fa-clock-o"></i> Duration</small>
                    <h4>{{ selectedStep[0].duration }}</h4>
                </div>
            </div>

            <!-- ANNOUNCEMENTS -->
            <div class="col-md-6" style="margin-top:50px">
                <div class="col-md-6" data-ng-repeat="announce in announcements">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-3x {{ announce.icon }}"></i>
                                </div>
                                <div class="col-xs-9 text-right">
                                    <p class="announcement-heading"><strong>{{ announce.val }}</strong></p>
                                    <p class="announcement-text">{{ announce.text }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


